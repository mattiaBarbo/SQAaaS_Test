name: Software Quality Assurance as a Service

on:
  push:
    branches: [main]

jobs:
  build: 
    runs-on: ubuntu-latest

    services:
      docker:
        image: docker:stable-dind
        options: --privileged  # Abilita privilegi Docker-in-Docker (DinD)
        
    name: Quality Assessment & Awarding
    steps:
        - name: Checkout repository
          uses: actions/checkout@v2
          with:
            submodules: true          
            fetch-depth: 0    

        - name: Build Docker images
          run: docker-compose build

        - name: Start Docker containers
          run: docker-compose up -d

        - name: Wait for containers to start
          run: sleep 30  # Attendi il tempo necessario per il caricamento dei container (regola generale, pu√≤ variare)

        #- name: Quality Tests
          #uses: eosc-synergy/sqaaas-assessment-action@v2
          #with:
            #repo: 'https://github.com/HPCI-Lab/yProv.git'
            #branch: 'main'

        
        - name: UniTests
          run: python3 -m pytest -v
          env: 
            PYTEST_PORT: 3000

        - name: Stop Docker containers
          run: docker-compose down

        
               
       





         

     
        
        
  
  
